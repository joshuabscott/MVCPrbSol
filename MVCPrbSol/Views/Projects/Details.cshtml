
@using Microsoft.AspNetCore.Identity
@inject UserManager<PSUser> UserManager
@inject MVCPrbSol.Services.IPSRolesService rolesService
@model MVCPrbSol.Models.ViewModels.ProjectTicketsViewModel

@{
    ViewData["Title"] = "Details";
}
<div class="container">
    <div class="row">
        <div class="col text-left">
            <h4>Viewing project details for</h4>
            <h1>
                @Html.DisplayFor(model => model.Project.Name)
            </h1>
        </div>

        <div class="col">
            <div class="card mt-3 mb-3 ml-3 mr-3">
                <div class="card-header text-right font-italic">

                    Assigned Users For @Html.DisplayFor(model => model.Project.Name)

                </div>

                <div class="card-body">
                    <dl class="row">
                        <dt class="col-sm-5">
                            Project Manager
                        </dt>
                        <dd class="col-sm-7">
                            @foreach (var user in Model.Project.ProjectUsers)
                            {
                                if (await rolesService.IsUserInRole(user.User, "ProjectManager"))
                                {
                                    <p>@user.User.FullName</p>
                                };
                            }
                        </dd>
                        <dt class="col-sm-5">
                            Developers
                        </dt>
                        <dd class="col-sm-7">
                            @foreach (var user in Model.Project.ProjectUsers)
                            {
                                if (await rolesService.IsUserInRole(user.User, "Developer"))
                                {
                                    <p>@user.User.FullName</p>
                                };
                            }
                        </dd>
                        <dt class="col-sm-5">
                            Quality Assurance
                        </dt>
                        <dd class="col-sm-7">
                            @foreach (var user in Model.Project.ProjectUsers)
                            {
                                if (await rolesService.IsUserInRole(user.User, "Submitter"))
                                {
                                    <p>@user.User.FullName</p>
                                };
                            }
                        </dd>
                    </dl>
                </div>
            </div>
        </div>
    </div>

    <hr />


    <div class="row">
        <div class="col">
            <div class="pt-2 pb-2">

                @if (User.IsInRole("Administrator") || User.IsInRole("ProjectManager") || User.IsInRole("Developer") || User.IsInRole("Submitter"))
                {
                    <a class="btn btn-primary" asp-controller="Tickets" asp-action="Create" asp-route-id="@Model.Project.Id">Create New Ticket</a>
                }
                @if (User.IsInRole("Administrator") || User.IsInRole("ProjectManager"))
                {
                    <a class="btn btn-primary" asp-action="AssignUsers" asp-route-id="@Model.Project.Id">Assign Team Members</a>
                    <a class="btn btn-primary" asp-action="Edit" asp-route-id="@Model.Project.Id">Edit Details</a>
                }
                @if (User.IsInRole("Administrator"))
                {
                    <a class="btn btn-danger text-light" data-target="#deleteModal" data-toggle="modal">Delete Project</a>
                }
            </div>
        </div>
    </div>


    <div class="row">
        <div class="col">
            <table class="myTable table table-striped table-bordered">
                <thead>
                    <tr>
                        <th>
                            Title
                        </th>
                        @*<th>
                                Description
                            </th>*@
                        <th>
                            Created
                        </th>
                        @*<th>
                                Updated
                            </th>*@
                        @*<th>
                                Project
                            </th>*@
                        <th>
                            Type
                        </th>
                        <th>
                            Priority
                        </th>
                        <th>
                            Status
                        </th>
                        @*<th>
                                OwnerUser
                            </th>*@
                        <th>
                            Developer
                        </th>
                        @*@if (User.IsInRole("Admin") || User.IsInRole("Project Manager") || User.IsInRole("Developer"))
                            {*@
                        <th>
                            Details
                        </th>
                        @*}*@
                    </tr>
                </thead>
                <tbody>
                    @foreach (var item in Model.Project.Tickets)
                    {
                        <tr>
                            <td>
                                @Html.DisplayFor(modelItem => item.Title)
                            </td>
                            @*<td>
                                    @Html.DisplayFor(modelItem => item.Description)
                                </td>*@
                            <td>
                                @Html.DisplayFor(modelItem => item.Created)
                            </td>
                            @*<td>
                                    @Html.DisplayFor(modelItem => item.Updated)
                                </td>*@
                            @*<td>
                                    @Html.DisplayFor(modelItem => item.Project.Name)
                                </td>*@
                            <td>
                                @Html.DisplayFor(modelItem => item.TicketType.Name)
                            </td>
                            <td>
                                @Html.DisplayFor(modelItem => item.TicketPriority.Name)
                            </td>
                            <td>
                                @Html.DisplayFor(modelItem => item.TicketStatus.Name)
                            </td>
                            @*<td>
                                    @Html.DisplayFor(modelItem => item.OwnerUser.Id)
                                </td>*@
                            <td>
                                @Html.DisplayFor(modelItem => item.DeveloperUser.FullName)
                            </td>
                            @*@if (User.IsInRole("Admin") || User.IsInRole("Project Manager") || User.IsInRole("Developer"))
                                {*@
                            <td>
                                <a class="btn btn-primary" asp-action="Details" asp-controller="Tickets" asp-route-id="@item.Id">Details</a>
                            </td>
                            @*}*@
                        </tr>
                    }
                </tbody>
            </table>
        </div>
    </div>
    <div class="row">
        <div class="col">

            <div class="pb-2 pt-1">
                <a class="btn btn-primary" asp-action="Index">Back to List</a>
            </div>
        </div>
    </div>


    @*Delete Modal*@
    <div class="modal" id="deleteModal">
        <div class="modal modal-dialog modal-dialog-centered">
            <div class="modal-content">
                <div class="modal-header text-center bg-dark">
                    <h4 class="modal-title text-light">Delete Project</h4>
                    <button type="button" class="btn bg-dark text-light" data-dismiss="modal">&times;</button>
                </div>
                <div class="modal-body">
                    <div class="container">
                        <div class="row">
                            <div class="col">
                                <p>Are you sure you want to delete this project?</p>
                                <form class="form-group" asp-action="Delete">
                                    <input type="hidden" asp-for="Project.Id" />
                                    <input type="submit" value="Delete" class="btn btn-danger" />
                                </form>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>
</div>